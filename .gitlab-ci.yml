---
generate-pipeline:
  stage: build
  image: python:3.9-slim
  script:
    - pip3 install -r requirements.txt
    - python3 .gitlab-ci.py > generated-config.yml
  artifacts:
    paths:
      - generated-config.yml
  tags:
    - environment-prd

run-pipeline:
  stage: deploy
  needs:
    - generate-pipeline
  trigger:
    include:
      - artifact: generated-config.yml
        job: generate-pipeline
    strategy: depend

trigger_custom_gcip_library:
  stage: .post
  trigger:
    project: otherproject/custom-gcip-library
    branch: master
    strategy: depend
  rules:
    - if: $CI_COMMIT_TAG
      when: never
    - if: $CI_COMMIT_BRANCH == "master"
