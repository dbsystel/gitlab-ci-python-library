stages:
- diff_project_resources_unstable
- deploy_project_resources_unstable
- diff_windows_vm_bucket_unstable
- deploy_windows_vm_bucket_unstable
- update_windows_vm_image_unstable
- diff_windows_vm_intances_unstable
- deploy_windows_vm_intances_unstable
- diff_project_resources_dev
- deploy_project_resources_dev
- copy_windows_vm_image_dev
- diff_windows_vm_intances_dev
- deploy_windows_vm_intances_dev
- diff_project_resources_tst
- deploy_project_resources_tst
- copy_windows_vm_image_tst
- diff_windows_vm_intances_tst
- deploy_windows_vm_intances_tst
- diff_project_resources_iat
- deploy_project_resources_iat
- copy_windows_vm_image_iat
- diff_windows_vm_intances_iat
- deploy_windows_vm_intances_iat
diff-cdk-project-resources-unstable:
  image: python:3.9-slim
  stage: diff_project_resources_unstable
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - cdk synth myapp-unstable-project-resources
  - cdk diff myapp-unstable-project-resources
  variables:
    MYPROJECT_RELEASE_VERSION: '>=0.dev'
  tags:
  - environment-iat
deploy-cdk-project-resources-unstable:
  image: python:3.9-slim
  needs:
  - job: diff-cdk-project-resources-unstable
    artifacts: true
  stage: deploy_project_resources_unstable
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - pip3 install gcip
  - python3 -m gcip.script_library.wait_for_cloudformation_stack_ready --stack-names
    'myapp-unstable-project-resources'
  - cdk deploy --strict --require-approval 'never' myapp-unstable-project-resources
  variables:
    MYPROJECT_RELEASE_VERSION: '>=0.dev'
  tags:
  - environment-iat
diff-cdk-windows-vm-bucket-unstable:
  image: python:3.9-slim
  stage: diff_windows_vm_bucket_unstable
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - cdk synth myapp-unstable-windows-vm-bucket
  - cdk diff myapp-unstable-windows-vm-bucket
  variables:
    MYPROJECT_RELEASE_VERSION: '>=0.dev'
  tags:
  - environment-iat
deploy-cdk-windows-vm-bucket-unstable:
  image: python:3.9-slim
  needs:
  - job: diff-cdk-windows-vm-bucket-unstable
    artifacts: true
  stage: deploy_windows_vm_bucket_unstable
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - pip3 install gcip
  - python3 -m gcip.script_library.wait_for_cloudformation_stack_ready --stack-names
    'myapp-unstable-windows-vm-bucket'
  - cdk deploy --strict --require-approval 'never' myapp-unstable-windows-vm-bucket
  variables:
    MYPROJECT_RELEASE_VERSION: '>=0.dev'
  tags:
  - environment-iat
update-windows-vm-image-unstable:
  image: python:3.9-slim
  stage: update_windows_vm_image_unstable
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - python3 update_windows_vm_image.py unstable
  variables:
    MYPROJECT_RELEASE_VERSION: '>=0.dev'
  rules:
  - if: $CI_PIPELINE_SOURCE == "merge_request_event"
    when: never
    allow_failure: false
  - if: $IMAGE_SOURCE_PASSWORD
    when: on_success
    allow_failure: false
  tags:
  - environment-iat
diff-cdk-windows-vm-intances-unstable:
  image: python:3.9-slim
  stage: diff_windows_vm_intances_unstable
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - cdk synth myapp-unstable-windows-vm-instances
  - cdk diff myapp-unstable-windows-vm-instances
  variables:
    MYPROJECT_RELEASE_VERSION: '>=0.dev'
  tags:
  - environment-iat
deploy-cdk-windows-vm-intances-unstable:
  image: python:3.9-slim
  needs:
  - job: diff-cdk-windows-vm-intances-unstable
    artifacts: true
  stage: deploy_windows_vm_intances_unstable
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - pip3 install gcip
  - python3 -m gcip.script_library.wait_for_cloudformation_stack_ready --stack-names
    'myapp-unstable-windows-vm-instances'
  - cdk deploy --strict --require-approval 'never' myapp-unstable-windows-vm-instances
  variables:
    MYPROJECT_RELEASE_VERSION: '>=0.dev'
  tags:
  - environment-iat
diff-cdk-project-resources-dev:
  image: python:3.9-slim
  stage: diff_project_resources_dev
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - cdk synth myapp-dev-project-resources
  - cdk diff myapp-dev-project-resources
  variables:
    MYPROJECT_RELEASE_VERSION: ==0.0.dev10
  tags:
  - environment-iat
deploy-cdk-project-resources-dev:
  image: python:3.9-slim
  needs:
  - job: diff-cdk-project-resources-dev
    artifacts: true
  stage: deploy_project_resources_dev
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - pip3 install gcip
  - python3 -m gcip.script_library.wait_for_cloudformation_stack_ready --stack-names
    'myapp-dev-project-resources'
  - cdk deploy --strict --require-approval 'never' myapp-dev-project-resources
  variables:
    MYPROJECT_RELEASE_VERSION: ==0.0.dev10
  tags:
  - environment-iat
copy-windows-vm-image-dev:
  image: python:3.9-slim
  stage: copy_windows_vm_image_dev
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - python3 update_windows_vm_image.py dev
  variables:
    MYPROJECT_RELEASE_VERSION: ==0.0.dev10
  tags:
  - environment-iat
diff-cdk-windows-vm-intances-barista-dev:
  image: python:3.9-slim
  stage: diff_windows_vm_intances_dev
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - cdk synth myapp-dev-windows-vm-instances-barista
  - cdk diff myapp-dev-windows-vm-instances-barista
  variables:
    MYPROJECT_RELEASE_VERSION: ==0.0.dev10
  tags:
  - environment-iat
deploy-cdk-windows-vm-intances-barista-dev:
  image: python:3.9-slim
  needs:
  - job: diff-cdk-windows-vm-intances-barista-dev
    artifacts: true
  stage: deploy_windows_vm_intances_dev
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - pip3 install gcip
  - python3 -m gcip.script_library.wait_for_cloudformation_stack_ready --stack-names
    'myapp-dev-windows-vm-instances-barista'
  - cdk deploy --strict --require-approval 'never' myapp-dev-windows-vm-instances-barista
  variables:
    MYPROJECT_RELEASE_VERSION: ==0.0.dev10
  tags:
  - environment-iat
diff-cdk-windows-vm-intances-impala-dev:
  image: python:3.9-slim
  stage: diff_windows_vm_intances_dev
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - cdk synth myapp-dev-windows-vm-instances-impala
  - cdk diff myapp-dev-windows-vm-instances-impala
  variables:
    MYPROJECT_RELEASE_VERSION: ==0.0.dev10
  tags:
  - environment-iat
deploy-cdk-windows-vm-intances-impala-dev:
  image: python:3.9-slim
  needs:
  - job: diff-cdk-windows-vm-intances-impala-dev
    artifacts: true
  stage: deploy_windows_vm_intances_dev
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - pip3 install gcip
  - python3 -m gcip.script_library.wait_for_cloudformation_stack_ready --stack-names
    'myapp-dev-windows-vm-instances-impala'
  - cdk deploy --strict --require-approval 'never' myapp-dev-windows-vm-instances-impala
  variables:
    MYPROJECT_RELEASE_VERSION: ==0.0.dev10
  tags:
  - environment-iat
diff-cdk-project-resources-tst:
  image: python:3.9-slim
  stage: diff_project_resources_tst
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - cdk synth myapp-tst-project-resources
  - cdk diff myapp-tst-project-resources
  variables:
    MYPROJECT_RELEASE_VERSION: ==0.0.dev10
  tags:
  - environment-iat
deploy-cdk-project-resources-tst:
  image: python:3.9-slim
  needs:
  - job: diff-cdk-project-resources-tst
    artifacts: true
  stage: deploy_project_resources_tst
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - pip3 install gcip
  - python3 -m gcip.script_library.wait_for_cloudformation_stack_ready --stack-names
    'myapp-tst-project-resources'
  - cdk deploy --strict --require-approval 'never' myapp-tst-project-resources
  variables:
    MYPROJECT_RELEASE_VERSION: ==0.0.dev10
  tags:
  - environment-iat
copy-windows-vm-image-tst:
  image: python:3.9-slim
  stage: copy_windows_vm_image_tst
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - python3 update_windows_vm_image.py tst
  variables:
    MYPROJECT_RELEASE_VERSION: ==0.0.dev10
  tags:
  - environment-iat
diff-cdk-windows-vm-intances-tst:
  image: python:3.9-slim
  stage: diff_windows_vm_intances_tst
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - cdk synth myapp-tst-windows-vm-instances
  - cdk diff myapp-tst-windows-vm-instances
  variables:
    MYPROJECT_RELEASE_VERSION: ==0.0.dev10
  tags:
  - environment-iat
deploy-cdk-windows-vm-intances-tst:
  image: python:3.9-slim
  needs:
  - job: diff-cdk-windows-vm-intances-tst
    artifacts: true
  stage: deploy_windows_vm_intances_tst
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - pip3 install gcip
  - python3 -m gcip.script_library.wait_for_cloudformation_stack_ready --stack-names
    'myapp-tst-windows-vm-instances'
  - cdk deploy --strict --require-approval 'never' myapp-tst-windows-vm-instances
  variables:
    MYPROJECT_RELEASE_VERSION: ==0.0.dev10
  tags:
  - environment-iat
diff-cdk-project-resources-iat:
  image: python:3.9-slim
  stage: diff_project_resources_iat
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - cdk synth myapp-iat-project-resources
  - cdk diff myapp-iat-project-resources
  variables:
    MYPROJECT_RELEASE_VERSION: ==0.0.dev10
  tags:
  - environment-iat
deploy-cdk-project-resources-iat:
  image: python:3.9-slim
  needs:
  - job: diff-cdk-project-resources-iat
    artifacts: true
  stage: deploy_project_resources_iat
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - pip3 install gcip
  - python3 -m gcip.script_library.wait_for_cloudformation_stack_ready --stack-names
    'myapp-iat-project-resources'
  - cdk deploy --strict --require-approval 'never' myapp-iat-project-resources
  variables:
    MYPROJECT_RELEASE_VERSION: ==0.0.dev10
  tags:
  - environment-iat
copy-windows-vm-image-iat:
  image: python:3.9-slim
  stage: copy_windows_vm_image_iat
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - python3 update_windows_vm_image.py iat
  variables:
    MYPROJECT_RELEASE_VERSION: ==0.0.dev10
  tags:
  - environment-iat
diff-cdk-windows-vm-intances-iat:
  image: python:3.9-slim
  stage: diff_windows_vm_intances_iat
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - cdk synth myapp-iat-windows-vm-instances
  - cdk diff myapp-iat-windows-vm-instances
  variables:
    MYPROJECT_RELEASE_VERSION: ==0.0.dev10
  tags:
  - environment-iat
deploy-cdk-windows-vm-intances-iat:
  image: python:3.9-slim
  needs:
  - job: diff-cdk-windows-vm-intances-iat
    artifacts: true
  stage: deploy_windows_vm_intances_iat
  script:
  - git clone --branch master --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/otherproject/configuration.git
  - ./install-dependencies.sh
  - pip3 install gcip
  - python3 -m gcip.script_library.wait_for_cloudformation_stack_ready --stack-names
    'myapp-iat-windows-vm-instances'
  - cdk deploy --strict --require-approval 'never' myapp-iat-windows-vm-instances
  variables:
    MYPROJECT_RELEASE_VERSION: ==0.0.dev10
  tags:
  - environment-iat
