stages:
- execute
execute-kaniko:
  image:
    name: gcr.io/kaniko-project/executor:debug
    entrypoint:
    - sh
  stage: execute
  script:
  - mkdir -p /kaniko/.docker && echo "{\"auths\":{\"https://index.docker.io/v1/\":{\"username\":\"$DOCKER_USER\",\"password\":\"$DOCKER_LOGIN\"}}}"
    > /kaniko/.docker/config.json
  - date
  - executor --context /path/to/project --dockerfile /path/to/project/Dockerfile --no-push
    --destination thomass/gcip:my-awsome-feature-branch
  - rm -rf /kaniko/.docker/config.json
