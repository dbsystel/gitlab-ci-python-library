bdist-wheel:
  artifacts:
    paths:
    - dist/
  script:
  - pip3 install --upgrade -r requirements.txt
  - python3 setup.py bdist_wheel
  stage: build
  tags: []
  variables: {}
evaluate-git-tag-pep404-conformity:
  rules:
  - allow_failure: false
    if: $CI_COMMIT_TAG
    when: on_success
  script:
  - pip3 install --upgrade gcip
  - python3 -m gcip.script_library.evaluate_git_tag_pep404_conformity
  stage: test
  tags: []
  variables: {}
flake8:
  script:
  - pip3 install --upgrade flake8
  - flake8
  stage: lint
  tags: []
  variables: {}
isort:
  script:
  - pip3 install --upgrade isort
  - isort --check .
  stage: lint
  tags: []
  variables: {}
pages-python-sphinx:
  artifacts:
    paths:
    - public
  rules:
  - allow_failure: false
    if: $CI_COMMIT_REF_NAME == "master"
    when: on_success
  - allow_failure: false
    if: $CI_COMMIT_TAG
    when: on_success
  script:
  - pip3 install --upgrade -r docs/requirements.txt
  - sphinx-build -b html -E -a docs public/${CI_COMMIT_REF_NAME}
  stage: build
  tags: []
  variables: {}
pytest:
  script:
  - pip3 install --upgrade -r requirements.txt
  - pytest
  stage: test
  tags: []
  variables: {}
stages:
- lint
- test
- build
- deploy
twine-upload-dev:
  rules:
  - allow_failure: false
    if: $CI_PIPELINE_SOURCE == "merge_request_event"
    when: never
  - allow_failure: false
    if: $CI_COMMIT_TAG
    when: never
  - allow_failure: false
    if: $CI_COMMIT_REF_NAME == "master"
    when: on_success
  script:
  - pip3 install --upgrade twine
  - python3 -m twine upload --non-interactive --disable-progress-bar dist/*
  stage: deploy
  tags: []
  variables:
    TWINE_PASSWORD: $ARTIFACTORY_DEV_PASSWORD
    TWINE_REPOSITORY_URL: https://my.artifactory.net/pypi/dev-repository
    TWINE_USERNAME: $ARTIFACTORY_DEV_USER
twine-upload-stable:
  rules:
  - allow_failure: false
    if: $CI_COMMIT_TAG
    when: on_success
  script:
  - pip3 install --upgrade twine
  - python3 -m twine upload --non-interactive --disable-progress-bar dist/*
  stage: deploy
  tags: []
  variables:
    TWINE_PASSWORD: $ARTIFACTORY_PROD_PASSWORD
    TWINE_REPOSITORY_URL: https://my.artifactory.net/pypi/prod-repository
    TWINE_USERNAME: $ARTIFACTORY_PROD_USER
