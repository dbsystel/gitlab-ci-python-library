stages:
- diff
- deploy
diff-cdk:
  stage: diff
  script:
  - cdk synth teststack
  - cdk diff -c foo=bar -c abra=kadabra teststack
deploy-cdk:
  needs:
  - job: diff-cdk
    artifacts: true
  stage: deploy
  script:
  - pip3 install gcip
  - python3 -m gcip.addons.cdk.tools.wait_for_cloudformation_stack_ready --stack-names
    'teststack'
  - cdk deploy --strict --require-approval 'never' --toolkit-stack-name toolkit-stack
    -c foo=bar -c abra=kadabra teststack
